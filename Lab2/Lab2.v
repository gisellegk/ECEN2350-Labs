
//=======================================================
//  This code is generated by Terasic System Builder
//=======================================================

module Lab2(

	//////////// CLOCK //////////
	input 		          		ADC_CLK_10,
	input 		          		MAX10_CLK1_50,
	input 		          		MAX10_CLK2_50,

	//////////// SEG7 //////////
	output		     [7:0]		HEX0,
	output		     [7:0]		HEX1,
	output		     [7:0]		HEX2,
	output		     [7:0]		HEX3,
	output		     [7:0]		HEX4,
	output		     [7:0]		HEX5,

	//////////// KEY //////////
	input 		     [1:0]		KEY,

	//////////// LED //////////
	output		     [9:0]		LEDR,

	//////////// SW //////////
	input 		     [9:0]		SW
);


//=======================================================
//  REG/WIRE declarations
//=======================================================

reg reg_reset;
wire reset_n;

reg reg_clk_switch;
wire clk_switch;

wire [3:0] num_0;
wire [3:0] num_1;
wire clock_1Hz;
wire clock_5Hz;
wire clock;
reg reg_clock;

wire [6:0] binary_value;
wire [3:0] day_1s; // 1's place of day val, can be 0-9.
wire [1:0] day_10s; // 10's place of day val, can be 0, 1, 2, 3
wire [1:0] month; // only 4 valid: january (0), february (1), march(2), april(3)

//=======================================================
//  Structural coding
//=======================================================
assign binary_value = (num_1 *10) + ({3'b0,num_0});

mod10_counter counter_0(clock, reset_n, 4'b1, num_0, num_1);

div10M_1 div1(ADC_CLK_10, reset_n, clock_1Hz);
div10M_5 div5(ADC_CLK_10, reset_n, clock_5Hz);

// KEY[1] is used as a latch for switching between the 1 Hz clock and the 5Hz. A reg type is used
// to have a boolean statement for whether it has been pressed or not.
always @(negedge KEY[1])
begin
	if (KEY[1])
		reg_clk_switch <= ~reg_clk_switch;
end

//This will switch the clock's speed depending on if KEY[1] has been pressed and assigns it to its
//respective clock.
always @(*)
begin
if (reg_clk_switch)
begin
	reg_clock = clock_5Hz;
end
if (~reg_clk_switch)
begin
   reg_clock = clock_1Hz;
end
end

//Assigns the clock to whichever clock has been toggled/
assign clock = reg_clock;

//When button is pressed, will start counter.
//When pressed again, sets its back to 0 until button is pressed again to restart the counter.
always @ (negedge KEY[0])	begin
		reg_reset <= ~reg_reset;
    end
assign reset_n = reg_reset;
assign LEDR[0] = reg_reset;

dateconverter dc(binary_value, SW[9], month, day_1s, day_10s);

// BCD number
sevensegment inst_0(num_0[3:0], 0, 0, ~reset_n, HEX4);
sevensegment inst_1(num_1[3:0], 0, 0, ~reset_n | (num_1==0), HEX5);

// Month
sevensegment month_0(month+1, 0, 0, ~reset_n, HEX2);
sevensegment month_1(0, 0, 0, 1, HEX3); // MSD of month is always blank
// Day
sevensegment day_0_disp(day_1s, 0, 0, ~reset_n, HEX0);
sevensegment day_1_disp(day_10s, 0, 0, ~reset_n | (day_10s==0),HEX1);

// clock to LED
assign LEDR[1] = clock;

endmodule
